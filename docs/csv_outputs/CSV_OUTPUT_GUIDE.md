# CSV Output Guide

This guide describes all CSV outputs generated by the Equity Financial Optimizer and how to use them for financial decision-making.

## Overview

The system follows a strict principle: **JSON for inputs, CSV for outputs**. All CSV files are generated for human analysis and decision-making only. No system components depend on CSV outputs.

## Output Structure

CSV files are generated in the following directory structure:
```
output/
├── {data_source}/           # 'demo' or 'user'
│   ├── timeline/           # Equity position timelines
│   │   └── equity_position_timeline.csv
│   └── {price_scenario}/   # Price growth assumption
│       └── scenario_{name}/
│           ├── {name}_annual_tax_detail.csv
│           ├── {name}_action_summary.csv
│           ├── {name}_annual_summary.csv
│           ├── {name}_state_timeline.csv
│           ├── {name}_transition_timeline.csv
│           ├── {name}_holding_period_tracking.csv
│           ├── {name}_pledge_obligations.csv
│           ├── {name}_charitable_carryforward.csv
│           └── {name}_tax_component_breakdown.csv
```

## Core Analysis Files

### annual_tax_detail.csv
**Purpose**: Complete annual tax breakdown showing all income components and tax calculations.

**Key Columns**:
- `year`: Tax year
- `w2_income`, `spouse_income`: Employment income
- `nso_ordinary_income`: Ordinary income from NSO exercises
- `short_term_gains`, `long_term_gains`: Capital gains by type
- `iso_bargain_element`: AMT adjustment from ISO exercises
- `regular_tax`, `amt_tax`, `total_tax`: Tax calculations
- `amt_credits_generated`, `amt_credits_used`: AMT credit tracking
- `charitable_deduction_cash`, `charitable_deduction_stock`: Deductions by type

**Use Cases**:
- Understand tax liability drivers year by year
- Track AMT impact and credit utilization
- Analyze charitable deduction effectiveness

### action_summary.csv
**Purpose**: Detailed record of every financial action taken in the scenario.

**Key Columns**:
- `date`, `type`: When and what action (exercise, sell, donate)
- `lot_id`, `quantity`, `price`: What was acted upon
- `exercise_date`, `holding_period_days`: For tax treatment
- `tax_treatment`: STCG, LTCG, qualifying/disqualifying
- `gross_proceeds`, `capital_gain`, `tax`: Financial impact
- `amt_adjustment`: For ISO exercises
- `pledge_created`: Donation obligations from sales
- `vest_expiration_date`: For option expiration tracking

**Use Cases**:
- Trace specific actions and their tax consequences
- Verify holding periods for tax optimization
- Track pledge creation from sales

### annual_summary.csv
**Purpose**: High-level yearly financial summary for quick comparison.

**Key Columns**:
- `year`: Calendar year
- `w2_income`, `total_income`: Income sources
- `exercise_costs`: Cash spent on option exercises
- `sale_proceeds`: Gross proceeds from share sales
- `capital_gains`: Total capital gains realized
- `donations`, `company_match`: Charitable giving
- `regular_tax`, `amt_tax`, `total_tax`: Tax summary
- `ending_cash`, `equity_value`, `net_worth`: Wealth tracking

**Use Cases**:
- Quick scenario comparison
- Cash flow planning
- Net worth progression tracking

## State & Transition Tracking

### state_timeline.csv
**Purpose**: Shows share quantities in each lifecycle state over time.

**Structure**: Matrix format with:
- Rows: Each lot and lifecycle state (Granted, Vested, Exercised, Disposed_Sold, Disposed_Donated, Expired, TOTAL)
- Columns: Years in the projection

**Use Cases**:
- Verify share accounting accuracy (TOTAL should be constant)
- Track vesting progression
- Monitor exercise and disposition patterns

### transition_timeline.csv
**Purpose**: Shows when shares move between lifecycle states.

**Structure**: Matrix format with:
- Rows: Each lot and transition type (Granting, Vesting, Exercising, Selling, Donating, Expiring)
- Columns: Years showing quantity transitioning

**Use Cases**:
- Identify when major equity events occur
- Plan for vesting and expiration dates
- Verify action timing

## Decision Support Tracking

### holding_period_tracking.csv
**Purpose**: Track tax treatment eligibility for all holdings.

**Key Columns**:
- `lot_id`: Specific share lot
- `exercise_date` When acquired
- `days_held`, `holding_status`: Short-term vs long-term
- `iso_qualifying_date`: For ISO qualifying disposition tracking
- `notes`: Warnings about disqualifying dispositions

**Use Cases**:
- Plan sales for optimal tax treatment
- Avoid accidental disqualifying dispositions
- Track progress toward long-term capital gains

### pledge_obligations.csv
**Purpose**: Track donation commitments from share sales.

**Key Columns**:
- `creation_date`, `source_sale_lot`: When and what created the pledge
- `sale_proceeds`, `pledge_percentage`, `pledge_amount`: Obligation details
- `deadline_date`, `days_until_deadline`: Urgency tracking
- `fulfilled_amount`, `remaining_amount`: Progress tracking

**Use Cases**:
- Ensure pledge compliance
- Plan donation timing
- Track fulfillment progress

### charitable_carryforward.csv
**Purpose**: Track unused charitable deductions for future years.

**Key Columns**:
- `year`: Tax year
- `cash_donations`, `stock_donations`: Donation amounts
- `agi`, `cash_limit`, `stock_limit`: AGI and deduction limits
- `cash_used`, `stock_used`: Deductions taken
- `cash_carryforward`, `stock_carryforward`: Unused amounts
- `carryforward_expiration_year`: When carryforward expires

**Use Cases**:
- Optimize multi-year donation strategies
- Track carryforward utilization
- Avoid losing deductions to expiration

### tax_component_breakdown.csv
**Purpose**: Detailed breakdown of tax calculations by income type.

**Key Columns**:
- `year`, `component_type`: When and what type (W2, ISO_exercise, NSO_exercise, STCG, LTCG)
- `lot_id`: Specific lot for equity transactions
- `amount`: Income or gain amount
- `federal_tax`, `state_tax`, `total_tax`: Tax by jurisdiction

**Use Cases**:
- Understand tax efficiency by transaction type
- Compare federal vs state tax impact
- Identify high-tax transactions

## Portfolio Analysis

### comparison.csv
**Purpose**: Side-by-side comparison of multiple scenarios.

**Location**: `output/{data_source}/portfolio_comparisons/`

**Key Columns**:
- `scenario`: Scenario name
- `total_cash_final`: Ending cash position
- `total_taxes_all_years`: Cumulative taxes paid
- `total_donations_all_years`: Cumulative charitable giving
- `total_equity_value_final`: Remaining equity value
- `pledge_fulfillment_maximalist`: Donation achievement percentage
- `outstanding_obligation`: Unfulfilled pledges

**Use Cases**:
- Compare strategies side-by-side
- Identify optimal approach for goals
- Understand trade-offs between scenarios

## Best Practices

1. **Always verify totals**: Use state_timeline.csv TOTAL rows to verify share accounting
2. **Check tax treatment**: Use holding_period_tracking.csv before planning sales
3. **Monitor obligations**: Review pledge_obligations.csv regularly
4. **Plan multi-year**: Use charitable_carryforward.csv for donation timing
5. **Compare scenarios**: Use comparison.csv to evaluate strategies

## Common Analysis Workflows

### Tax Optimization Review
1. Start with `annual_tax_detail.csv` to identify high-tax years
2. Drill into `tax_component_breakdown.csv` for specific drivers
3. Check `holding_period_tracking.csv` for better timing options
4. Review `action_summary.csv` for specific transactions

### Charitable Giving Analysis
1. Review `pledge_obligations.csv` for commitments
2. Check `charitable_carryforward.csv` for deduction capacity
3. Analyze `annual_summary.csv` for donation impact
4. Plan timing with `holding_period_tracking.csv`

### Liquidity Planning
1. Start with `annual_summary.csv` for cash flow
2. Check `action_summary.csv` for large transactions
3. Review `pledge_obligations.csv` for upcoming needs
4. Plan exercises with `transition_timeline.csv`

## Tips for Excel/Sheets Analysis

- Use pivot tables on `action_summary.csv` to aggregate by year or action type
- Create charts from `annual_summary.csv` for visual trends
- Use conditional formatting on `pledge_obligations.csv` to highlight near deadlines
- Filter `holding_period_tracking.csv` by days_held < 365 for short-term holdings
- Sum columns in `tax_component_breakdown.csv` to verify total tax calculations

## Data Integrity Checks

1. **Share Conservation**: Sum of all states in `state_timeline.csv` should be constant
2. **Tax Totals**: Sum of components in `tax_component_breakdown.csv` should match `annual_tax_detail.csv`
3. **Cash Flow**: Year-end cash in `annual_summary.csv` should match next year's starting cash
4. **Pledge Math**: Sale proceeds × pledge percentage should equal pledge amount created

Remember: These CSVs are for analysis only. All calculations are performed using JSON inputs and internal data structures.
